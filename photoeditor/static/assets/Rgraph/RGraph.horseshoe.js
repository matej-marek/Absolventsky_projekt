
RGraph=window.RGraph||{isrgraph:true,isRGraph:true,rgraph:true};RGraph.Horseshoe=function(conf)
{var id=conf.id
var canvas=document.getElementById(id);var min=conf.min;var max=conf.max;var value=conf.value;this.id=id;this.canvas=canvas;this.context=this.canvas.getContext?this.canvas.getContext("2d",{alpha:(typeof id==='object'&&id.alpha===false)?false:true}):null;this.canvas.__object__=this;this.type='horseshoe';this.min=RGraph.stringsToNumbers(min);this.max=RGraph.stringsToNumbers(max);this.value=RGraph.stringsToNumbers(value);this.centerx=null;this.centery=null;this.radius=null;this.isRGraph=true;this.isrgraph=true;this.rgraph=true;this.currentValue=null;this.uid=RGraph.createUID();this.canvas.uid=this.canvas.uid?this.canvas.uid:RGraph.createUID();this.colorsParsed=false;this.coordsText=[];this.original_colors=[];this.firstDraw=true;if(this.value<=0.0000001){this.value=0.0000001;}
this.properties={radius:null,centerx:null,centery:null,width:10,marginLeft:15,marginRight:15,marginTop:15,marginBottom:15,backgroundColor:'#eee',colors:['black'],textFont:'Arial, Verdana, sans-serif',textSize:70,textColor:'black',textBold:false,textItalic:false,textAccessible:true,textAccessibleOverflow:'visible',textAccessiblePointerevents:false,labelsCenter:true,labelsCenterFont:null,labelsCenterSize:null,labelsCenterColor:null,labelsCenterBold:null,labelsCenterItalic:null,labelsCenterUnitsPre:'',labelsCenterUnitsPost:'',labelsCenterDecimals:0,labelsCenterPoint:'.',labelsCenterThousand:',',labelsCenterSpecific:'',labelsCenterOffsetx:0,labelsCenterOffsety:0,endsRadius:null,endsColor:null,contextmenu:null,annotatable:false,annotatableColor:'black',adjustable:false,clearto:'rgba(0,0,0,0)'}
if(!this.canvas){alert('[HORSESHOE] No canvas support');return;}
var properties=this.properties;this.path=RGraph.pathObjectFunction;if(RGraph.Effects&&typeof RGraph.Effects.decorate==='function'){RGraph.Effects.decorate(this);}
this.responsive=RGraph.responsive;this.set=function(name)
{var value=typeof arguments[1]==='undefined'?null:arguments[1];if(arguments.length===1&&typeof arguments[0]==='object'){for(i in arguments[0]){if(typeof i==='string'){this.set(i,arguments[0][i]);}}
return this;}
properties[name]=value;return this;};this.get=function(name)
{return properties[name];};this.draw=function()
{RGraph.fireCustomEvent(this,'onbeforedraw');if(!this.canvas.__rgraph_aa_translated__){this.context.translate(0.5,0.5);this.canvas.__rgraph_aa_translated__=true;}
if(this.value>this.max)this.value=this.max;if(this.value<this.min)this.value=this.min;this.currentValue=this.value;this.marginLeft=properties.marginLeft;this.marginRight=properties.marginRight;this.marginTop=properties.marginTop;this.marginBottom=properties.marginBottom;this.centerx=((this.canvas.width-this.marginLeft-this.marginRight)/2)+this.marginLeft;this.centery=((this.canvas.height-this.marginBottom-this.marginTop)/2)+this.marginTop;this.radius=Math.min((this.canvas.width-this.marginLeft-this.marginRight)/2,(this.canvas.height-this.marginTop-this.marginBottom)/2);this.coordsText=[];if(typeof properties.centerx==='number')this.centerx=properties.centerx;if(typeof properties.centery==='number')this.centery=properties.centery;if(typeof properties.radius==='number')this.radius=properties.radius;if(!this.colorsParsed){this.parseColors();this.colorsParsed=true;}
this.drawMeter();this.drawLabels();if(properties.contextmenu){RGraph.showContext(this);}
RGraph.installEventListeners(this);if(this.firstDraw){this.firstDraw=false;RGraph.fireCustomEvent(this,'onfirstdraw');this.firstDrawFunc();}
RGraph.fireCustomEvent(this,'ondraw');return this;};this.exec=function(func)
{func(this);return this;};this.drawMeter=function()
{var angle=this.getAngle(this.currentValue);this.path('b a % % % 0 6.29 false a % % % 6.29 0 true f %',this.centerx,this.centery,this.radius,this.centerx,this.centery,this.radius-properties.width,properties.backgroundColor);this.path('b a % % % % % false a % % % % % true f %',this.centerx,this.centery,this.radius,RGraph.TWOPI-RGraph.HALFPI,angle,this.centerx,this.centery,this.radius-properties.width,angle,RGraph.TWOPI-RGraph.HALFPI,properties.colors[0]);this.path('b lw 3 a % % % 0 % false f % s white',this.centerx,this.centery-this.radius+(properties.width/2),typeof properties.endsRadius==='number'?properties.endsRadius:(properties.width*1.5),RGraph.TWOPI,typeof properties.endsColor==='string'?properties.endsColor:properties.colors[0]);var coords=RGraph.getRadiusEndPoint(this.centerx,this.centery,angle,this.radius-(properties.width/2));this.path('b lw 3 a % % % 0 % false f % s white',coords[0],coords[1],typeof properties.endsRadius==='number'?properties.endsRadius:(properties.width*1.5),RGraph.TWOPI,typeof properties.endsColor==='string'?properties.endsColor:properties.colors[0]);this.context.lineWidth=1;};this.drawLabels=function()
{if(!properties.labelsCenter){return;}
var textConf=RGraph.getTextConf({object:this,prefix:'labelsCenter'});RGraph.text({object:this,font:textConf.font,italic:textConf.italic,bold:textConf.bold,size:textConf.size,color:textConf.color,x:this.centerx+properties.labelsCenterOffsetx,y:this.centery+properties.labelsCenterOffsety,text:properties.labelsCenterSpecific?properties.labelsCenterSpecific:RGraph.numberFormat({object:this,number:this.value.toFixed(properties.labelsCenterDecimals),unitspre:properties.labelsCenterUnitsPre,unitspost:properties.labelsCenterUnitsPost,point:properties.labelsCenterPoint,thousand:properties.labelsCenterThousand}),halign:'center',valign:'center',accessible:properties.textAccessible});};this.getShape=function(e){};this.getValue=function(e)
{var mouseXY=RGraph.getMouseXY(e);var angle=RGraph.getAngleByXY(this.centerx,this.centery,mouseXY[0],mouseXY[1]);angle+=RGraph.HALFPI;if(angle>RGraph.TWOPI){angle-=RGraph.TWOPI;}
var value=((angle/RGraph.TWOPI)*(this.max-this.min))+this.min;value=Math.max(value,this.min);value=Math.min(value,this.max);return value;};this.getObjectByXY=function(e)
{var mouseXY=RGraph.getMouseXY(e);var radius=RGraph.getHypLength(this.centerx,this.centery,mouseXY[0],mouseXY[1]);if(radius>this.radius){return null;}
return this;};this.adjusting_mousemove=function(e)
{if(properties.adjustable&&RGraph.Registry.get('adjusting')&&RGraph.Registry.get('adjusting').uid==this.uid){this.value=this.getValue(e);RGraph.clear(this.canvas);RGraph.redrawCanvas(this.canvas);RGraph.fireCustomEvent(this,'onadjust');}};this.getAngle=function(value)
{if(value>this.max||value<this.min){return null;}
var angle=(((value-this.min)/(this.max-this.min))*RGraph.TWOPI)-RGraph.HALFPI;if(value===this.max)angle-=0.00001;if(value===this.min)angle+=0.00001;return angle;};this.parseColors=function()
{if(this.original_colors.length===0){this.original_colors.backgroundColor=RGraph.arrayClone(properties.backgroundColor);this.original_colors.colors=RGraph.arrayClone(properties.colors);}
properties.backgroundColor=this.parseSingleColorForGradient(properties.backgroundColor);var colors=properties.colors;if(colors&&colors.length){for(var i=0;i<colors.length;++i){colors[i]=this.parseSingleColorForGradient(colors[i]);}}};this.reset=function()
{};this.parseSingleColorForGradient=function(color)
{if(!color||typeof color!='string'){return color;}
if(color.match(/^gradient\((.*)\)$/i)){if(color.match(/^gradient\(({.*})\)$/i)){return RGraph.parseJSONGradient({object:this,def:RegExp.$1,radial:true});}
var parts=RegExp.$1.split(':');var grad=this.context.createLinearGradient(properties.marginLeft,0,this.canvas.width-properties.marginLeft-properties.marginRight,0);var diff=1/(parts.length-1);grad.addColorStop(0,RGraph.trim(parts[0]));for(var j=1,len=parts.length;j<len;++j){grad.addColorStop(j*diff,RGraph.trim(parts[j]));}}
return grad?grad:color;};this.on=function(type,func)
{if(type.substr(0,2)!=='on'){type='on'+type;}
if(typeof this[type]!=='function'){this[type]=func;}else{RGraph.addCustomEventListener(this,type,func);}
return this;};this.firstDrawFunc=function()
{};this.grow=function()
{var obj=this;obj.currentValue=obj.currentValue||obj.min;var opt=arguments[0]||{},frames=opt.frames||30,frame=0,diff=obj.value-obj.currentValue,step=diff/frames,callback=arguments[1]||function(){},initial=obj.currentValue
function iterator()
{obj.value=initial+(frame++ *step);RGraph.clear(obj.canvas);RGraph.redrawCanvas(obj.canvas);if(frame<=frames){RGraph.Effects.updateCanvas(iterator);}else{callback(obj);}}
iterator();return this;};RGraph.register(this);RGraph.parseObjectStyleConfig(this,conf.options);};