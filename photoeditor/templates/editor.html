{% load static %}
<html>
    <head>
        <title>{{preklad.meta.title}}</title>
        <link rel="icon" type="image/ico" href="{% static '/assets/favicon/favicon.ico' %}">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> 
        <script src="{% static 'assets/canvasLayering.js' %}"></script>
        <script src="{% static 'assets/jquery-3.5.1.min.js' %}"></script>
         <script type="text/javascript" src="{% static 'assets/g_charts.js' %}"></script>
        <script src="{% static 'assets/dropzone.js' %}"></script>
        <link rel="stylesheet" href="{% static 'assets/style/dropzone.css'%}">
        <link rel="stylesheet" href="{% static 'assets/style/main.min.css'%}">
        <script src="{% static 'assets/Rgraph/RGraph.common.core.js' %}"></script> 
        <script src="{% static 'assets/Rgraph/RGraph.line.js' %}"></script>
        <script src="{% static 'assets/Rgraph/RGraph.svg.common.core.js' %}"></script>
        <script src="{% static 'assets/Rgraph/RGraph.svg.line.js' %}"></script>   
        <script src="{% static 'assets/Rgraph/RGraph.common.dynamic.js' %}"></script>  
        <script src="{% static 'assets/Rgraph/RGraph.drawing.xaxis.js ' %}"></script>  
        <script>
            
        let curveschart,options;
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);
  
        function drawChart() {
            var datas=new Array(['X','Y']);
            for (var i = 0; i < 256; i++) {
                datas.push([i,i]); 
            }
          var data = google.visualization.arrayToDataTable(datas);
  
          options = {
            curveType: 'function',
            legend: 'none',
            backgroundColor: { fill:'transparent' },
            chartArea: {width: '100%', height: '100%'},
            vAxis: {
    viewWindowMode:'explicit',
        viewWindow: {
            max:255,
            min:0
        },
        format:null,
        gridlines: { count: 0 }
    },hAxis:{
        gridlines: { count: 0 }
    }
          };
  
          curveschart = new google.visualization.LineChart(document.getElementById('curvesChart'));
  
          curveschart.draw(data, options);
        }
        </script>
    </head>
    <body>
        <input name="file" id="file-select" class="dropzoned" type="file" />
        <div class="loading">
        <div class="loader"></div></div>
        <!--<div class="agreeBackground">
            <div class="agreeTable">
                <div class="infoTableBody">
                    <h1>{{preklad.agree.nadpis}}</h1>
                    <p>{{preklad.agree.text}}<p>
                    <div class="footerAgree">
                        <button class="agree">{{preklad.agree.agree}}</button>
                        <a href="/documenation"><button class="disline">{{preklad.agree.disline}}</button></a>
                    </div>
                </div>
            </div>
        </div>-->
        <div class="infoBackground windowBackground">
            <div class="windowTable">
                <div class="navbarWindow">
                    <button class="infoHide">X</button>
                    <button class="minimalize" data-name="info">_</button>
                </div>
                <div class="windowTableBody">
                    <h1>{{preklad.ap.nadpis}}</h1>
                    <h2>{{preklad.ap.podnadpis}}</h2>
                    <h3>{{preklad.ap.vedouci}}</h3>
                    <p>{{preklad.ap.text}}<p>
                    <p>Celý projekt na <a href="https://github.com/matej-marek/Absolventsky_projekt" target="_blank">GitHubu</a>.</p>
                </div>
                <div class="windowTableFooter">
                    <p>{{preklad.ap.verze}} {{verze}} | {{preklad.ap.datum}} {{datum_vydani}}</p>
                    <p>Commit {{commitZkraceny}}</p>
                </div>
            </div>
        </div>
        <div class="settingBackground windowBackground">
            <div class="windowTable">
                <div class="navbarWindow">
                    <button class="settingHide">X</button>
                    <button class="minimalize" data-name="setting">_</button>
                </div>
                <div class="windowTableBody">
                    <p>Close side bars<input id="closeSides" type="checkbox"></p>
                    <p>Default background color<input id="dfbgcolor" type="color"></p>
                    <p>Default saving file<input id="savingFromat" type="text"></p>
                    <label for="savingFormat">Default saving format: </label>
                    <select name="savingFormat" id="savingFormat">
                        <option value="jpg">jpg</option>
                        <option value="png">png</option>
                        <option value="webp">webp</option>
                    </select>
                </div>
                <div class="windowTableFooter">
                    <p>{{preklad.ap.verze}} {{verze}} | {{preklad.ap.datum}} {{datum_vydani}}</p>
                    <p>Commit {{commitZkraceny}}</p>
                </div>
            </div>
        </div>
        <div class="uploadProjectBackground windowBackground">
            <div class="windowTable">
                <div class="navbarWindow">
                    <button class="uploadProjectHide">X</button>
                    <button class="minimalize" data-name="windows">_</button>
                </div>
                <div class="windowTableBody">
                    <input type="file" name="inputfile" id="inputfile"> 
                    <br> 
                    <pre id="output"></pre> 
                </div>
                <div class="windowTableFooter">
                    <p>{{preklad.ap.verze}} {{verze}} | {{preklad.ap.datum}} {{datum_vydani}}</p>
                    <p>Commit {{commitZkraceny}}</p>
                </div>
            </div>
        </div>
        <div class="toolsBackground windowBackground">
            <div class="windowTable">
                <div class="navbarWindow">
                    <button class="toolsHide">X</button>
                    <button class="minimalize" data-name="tools">_</button>
                </div>
                <div class="windowTableBody">
                    <input type="file" name="inputfile" id="inputfile"> 
                    <br> 
                    <pre id="output"></pre> 
                </div>
                <div class="windowTableFooter">
                    <p>{{preklad.ap.verze}} {{verze}} | {{preklad.ap.datum}} {{datum_vydani}}</p>
                    <p>Commit {{commitZkraceny}}</p>
                </div>
            </div>
        </div>
        <div class="windowsBackground windowBackground">
            <div class="windowTable">
                <div class="navbarWindow">
                    <button class="windowsHide">X</button>
                    <button class="minimalize" data-name="windows">_</button>
                </div>
                <div class="windowTableBody">
                    Histogram:<input type="checkbox" id="histogramShow" checked><br>
                    Layers:<input type="checkbox" id="layersShow" checked><br>
                    Převodní charakteristika:<input type="checkbox" id="curvesShow" checked>
                </div>
                <div class="windowTableFooter">
                    <p>{{preklad.ap.verze}} {{verze}} | {{preklad.ap.datum}} {{datum_vydani}}</p>
                    <p>Commit {{commitZkraceny}}</p>
                </div>
            </div>
        </div>
        <div class="zalozky">
            <template id="zalozkaTemplate">
                <div class="itemZalozky">
                    <p></p>
                    <button class="closeItem" onclick="closeItem(this)">X</button>
                    <button class="openItem" onclick="openItem(this)">&#9645;</button> 
                </div>
            </template>
        </div>
        <div class="horni-bar">
            <div class="cv">
                <input type="text" id="nazev" class="nameProject"value="{{preklad.project.default}}">
                <button class="downloads btn-nav">{{preklad.button.download}}</button>
                <button class="info btn-nav">{{preklad.button.info}}</button>
                <button class="windows btn-nav">{{preklad.button.windows}}</button>
                <button class="tool btn-nav">{{preklad.button.tools}}</button>
                <button class="setting btn-nav">{{preklad.button.setting}}</button>
            </div>
        </div>

        <div class="toolBar">
            <div class="show tools">
                <button class="btn-tools hand"><img src="{% static 'assets/icons/hand.png' %}"></button>
                <button class="btn-tools rotation"><img src="{% static 'assets/icons/rotate.png' %}"></button>
                <button class="btn-tools crop"><img src="{% static 'assets/icons/crop.png' %}"></button>
                <button class="btn-tools pointer"><img src="{% static 'assets/icons/pointer.png' %}"></button>
                <button class="btn-tools brush"><img src="{% static 'assets/icons/brush.png' %}"></button>
            </div> 
            <div class="showing">
                <div class="closeTools hide" onclick="show('tools','left')">
                    <svg width="20px" height="100px">
                        <polygon points="0,0 20,25 20,75 0,100" style="fill:#505050"/>
                        <circle cx="7" cy="30" r="4" fill="#202020"></circle>
                        <circle cx="7" cy="50" r="4" fill="#202020"></circle>
                        <circle cx="7" cy="70" r="4" fill="#202020"></circle>
                    </svg>
                </div>
            </div>
        </div>

        <div class="workspace" id="workspace">
            <div id="foto">
            </div>
        </div>
        <div class="side_panel">
            <div class="rightPanel">
                <div class="histograms border-top" id="histograms">
                </div>
                <div class="curves border-top" id="curves">
                    <canvas id="PrevodniChrka" width="200" height="200" style="background-image: linear-gradient(white,black)">[No canvas support]</canvas>
                </div>
                <div class="border-top">
                    <div class="AddLayer">
                        <button onclick="makeColorLayer()"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-plus" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M8 7a.5.5 0 0 1 .5.5V9H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V10H6a.5.5 0 0 1 0-1h1.5V7.5A.5.5 0 0 1 8 7z"/>
                            <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                            <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                          </svg></button>
                    </div>
                <div class="layers" id="layers" style="overflow-y: scroll; height:200px;">
                </div>
                </div> 
                </div>
                    <div class="closeDash" onclick="show('rightPanel','right')">
                        <svg width="20px" height="100px">
                            <polygon points="20,0 0,25 0,75 20,100" style="fill:#505050"/>
                            <circle cx="13" cy="30" r="4" fill="#202020"></circle>
                            <circle cx="13" cy="50" r="4" fill="#202020"></circle>
                            <circle cx="13" cy="70" r="4" fill="#202020"></circle>
                        </svg>
                </div> 
        </div>
            
        <div class="LayerControls" id="LayerControls">
            <label for="alpha">Aplha:</label><input type="number" min="0" max="100" value="100" name="alpha" id="alpha">
            <label for="sharpen">Doostření:</label> <input type="number" min="0" max="1" value="0" step="0.01"id="sharpen" name="sharpen">
            <label for="brightness">Jas:</label><input type="number" min="-10" max="10" value="0" step="0.01" id="brightness" name="sharpen">
        </div>

        {% csrf_token %}        
    </body>

    <script>
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        </script>
<script>

let size=[1920,1080];
let canvas = new Canvas(size,"foto","width:1000; height:500;");
let DFBGColor=[];
canvas.createLayer("Background");
canvas.showHistogram("histograms","none");
canvas.layershow("layers");
</script>
<script>$(".loading").hide();</script>
        <script>
            /* change name of layer*/
            $(document).on('change', '.layerName', function () {
                var id= $(this).attr("layer-id");
                var value = $(this).val();
                canvas.layers[id].name=value;
            });

            $(document).on('click', '.layerShowing', function () {
                if($(".activeLayer").length>0){
                    $(".activeLayer").removeClass("activeLayer");
                }
                $(this).addClass("activeLayer");
                var id= $(".activeLayer").attr("layer-id");
                $("#alpha").val(canvas.layers[id].alphaProcesingData);
            });
            $("#alpha").on("change",function(){
                var id= $(".activeLayer").attr("layer-id");
                canvas.layers[id].alphaProcesing($(this).val());
            });
            $("#brightness").on("change",function(){
                var id= $(".activeLayer").attr("layer-id");
                canvas.layers[id].brightness($(this).val());
            });
            $("#sharpen").on("change",function(){
                var id= $(".activeLayer").attr("layer-id");
                canvas.layers[id].sharpen($(this).val());
            });
            $(".downloads").click(function(){
                console.log($(".nameProject").val());
                canvas.download($(".nameProject").val());
            });
            $(".btn-tools").click(function(){
                if($(".btn-tools-active")){
                    $(".btn-tools-active").removeClass("btn-tools-active");
                }
                $(this).addClass("btn-tools-active");
            });
            /* save format for saving a work */
            $(".save").click(function(){
                var text= "@version "+"{{verze}}"+"\n";
                text+="@layer-number: "+canvas.layers.length+"\n";
                for(var i=0;i<canvas.layers.length;i++){
                    text+="@layer-"+i+" \n#data: "+canvas.layers[i].layer.scene.canvas.toDataURL("image/png")+"\n";
                }
                var blob = new Blob([text],
                { type: "text/plain;charset=utf-8" });
                saveAs(blob, $(".nameProject").val()+".ap");
            });
            document.getElementById('inputfile').addEventListener('change', function() { 
                    var fr=new FileReader(); 
                    fr.onload=function(){ 
                        canvas=new Canvas(size);
                        var img=[];
                        var data=fr.result.split("\n");
                        for(var x=0;x<data.length;x++){
                            if(data[x][0]=="#"){
                                var image= new Image();
                                image.src= data[x].split(": ")[1];
                                image.id="layer";
                                img.push({"img":image,"aplha":80});
                            }
                        }
                        setTimeout(() => {  
                            for(var i=0; i<img.length;i++){
                                var width=img[i]["img"].width;
                                var height=img[i]["img"].height;
                                var pomer=width/height;
                                if(height>size[1]){
                                    height=size[1];
                                    width=pomer*size[1];
                                }
                                else if(width>size[0]){
                                    width=size[0];
                                    height=pomer*size[0];
                                }
                                canvas.createLayer("Layer "+canvas.layers.length,[width, height]);
                                var layer=canvas.layers[canvas.layers.length-1];
                                layer.importImage(img[i]["img"]);
                                layer.alpha=img[i]["aplha"];
                            }
                            canvas.render(true);
                            $("#canvas-layers").css("width",1000);
                            $("#canvas-layers").css("height",500);
                            $("#canvas-layers").hide();
                        }, data.length*200);
                    } 
                    fr.readAsText(this.files[0]); 
                }) 
            
            let clientwindow=[$(".workspace").css("width").replace("px",""),$(".workspace").css("height").replace("px","")];
            var basicsizes=[1000,500];
            $("#canvas-layers").css("width",basicsizes[0]);
            $("#canvas-layers").css("height",basicsizes[1]);
            if($(".rightPanel").css("display")=="none"){
                    var pravybar=0;
                }
                else{
                    var pravybar=$(".rightPanel").css("width").replace("px","");
                }
                if($(".tools").css("display")=="none"){
                    var levybar=0;
                }
                else{
                    var levybar=parseInt($(".tools").css("width").replace("px",""));
                }
                var left=((clientwindow[0]-pravybar-levybar-basicsizes[0])/2)+levybar;
            $("#canvas-layers").css({"position":"relative","top":(clientwindow[1]-basicsizes[1])/2,"left":left});
            function zoom(event) {
                var mensi=0.9;
                if(event.deltaY<0){
                    scaleratio=mensi
                }
                else{
                    scaleratio=1/mensi;
                }
                var sirka=$("#canvas-layers").css("width").replace("px","")*scaleratio;
                var vyska=$("#canvas-layers").css("height").replace("px","")*scaleratio;
                if(!posun){
                    if($(".rightPanel").css("display")=="none"){
                        var pravybar=0;
                    }
                    else{
                        var pravybar=$(".rightPanel").css("width").replace("px","");
                    }
                    if($(".tools").css("display")=="none"){
                        var levybar=0;
                    }
                    else{
                        var levybar=parseInt($(".tools").css("width").replace("px",""));
                    }
                    var left=((clientwindow[0]-pravybar-levybar-sirka)/2)+levybar;
                    $("#canvas-layers").css({"position":"relative","width":sirka,"height":vyska,"top":(clientwindow[1]-vyska)/2,"left":left});
                }
                else{
                    $("#canvas-layers").css({"position":"relative","width":sirka,"height":vyska});
                }
                canvas.render();
            }
            let scaleratio = 1;
            document.onwheel = zoom;
        </script>
        <script>
var dragTimer;
$(document).on('dragover', function(e) {
  var dt = e.originalEvent.dataTransfer;
  if (dt.types && (dt.types.indexOf ? dt.types.indexOf('Files') != -1 : dt.types.contains('Files'))) {
    $("#file-select").show();
    window.clearTimeout(dragTimer);
  }
});
$(document).on('dragleave', function(e) {
  dragTimer = window.setTimeout(function() {
    $("#file-select").hide();
  }, 25);
});

$("#file-select").hide();



        var mouse=[];
        var mousebefore=[]
        let posun=false;
        var down = false;
        var cropstart=[];
        var cropend=[];
        /* je zmačkutá myš? */
        document.getElementById("workspace").ondblclick = function(event){
            let clientwindow=[$(".workspace").css("width").replace("px",""),$(".workspace").css("height").replace("px","")];
            var basicsizes=[1000,500];
            $("#canvas-layers").css("width",basicsizes[0]);
            $("#canvas-layers").css("height",basicsizes[1]);
            if($(".rightPanel").css("display")=="none"){
                    var pravybar=0;
                }
                else{
                    var pravybar=$(".rightPanel").css("width").replace("px","");
                }
                if($(".tools").css("display")=="none"){
                    var levybar=0;
                }
                else{
                    var levybar=parseInt($(".tools").css("width").replace("px",""));
                }
                var left=((clientwindow[0]-pravybar-levybar-basicsizes[0])/2)+levybar;
            $("#canvas-layers").css({"position":"relative","top":(clientwindow[1]-basicsizes[1])/2,"left":left});
        posun=false};
        $("#workspace").mousedown(function(event) {
            down = true;
            if($(".btn-tools-active").hasClass("crop")){
                cropstart=[event.clientX,event.clientY];
            }
            else if($(".btn-tools-active").hasClass("brush")){
                var id = $(".activeLayer").attr("layer-id");
                canvas.layers[id].brush([event.clientX,event.clientY],10);
            }
            else if($(".btn-tools-active").hasClass("pointer")){
                var id = $(".activeLayer").attr("layer-id");
                
                canvas.layers[id].setPosition(10,10);
            }
            else if($(".btn-tools-active").hasClass("rotation")){
                var id = $(".activeLayer").attr("layer-id");
                
                canvas.layers[id].rotation=10;
                canvas.render();
            }
        }).mouseup(function(event) {
            down = false;  
            mousebefore=[];
            mouse=[];
            if($(".btn-tools-active").hasClass("crop")){
                var cropend=[event.clientX,event.clientY];
                var pomerCR=canvas.size[0]/$("#canvas-layers").css("width").replace("px","");
                var vyska=(Math.max(cropend[1],cropstart[1])-Math.min(cropend[1],cropstart[1]))*pomerCR;
                var sirka=(Math.max(cropend[0],cropstart[0])-Math.min(cropend[0],cropstart[0]))*pomerCR;
                var levo=(Math.min(cropend[0],cropstart[0])-$("#canvas-layers").css("left").replace("px",""))*pomerCR;
                var top=(Math.min(cropend[1],cropstart[1])-$("#canvas-layers").css("top").replace("px",""))*pomerCR;
                console.log(levo);
                canvas.layers.forEach(function(layer){
                    layer.position[0]-=levo;
                    layer.position[1]-=top;
                });
                var pomer= vyska/sirka;
                canvas.canvas.height=vyska;
                canvas.canvas.width=sirka;
                $("#canvas-layers").css("height",vyska/pomerCR)
                $("#canvas-layers").css("width",$("#canvas-layers").css("height").replace("px","")/pomer)
                canvas.render();
                cropstart=[];
                cropend=[];
            }
        });
        /* pohyb s canvasem pokud je zapnuta ruka */
        document.getElementById("workspace").onmousemove = function(e){
            if($(".btn-tools-active").hasClass("hand")){
                if(down){
                    if(mousebefore!=[]){
                        mousebefore=mouse, mouse=[e.clientX,e.clientY];
                    }
                    else{
                        mouse=[e.clientX,e.clientY], mousebefore=mouse;
                    }
                    posun=true, rozdily=mousebefore[1]-mouse[1], rozdilx=mousebefore[0]-mouse[0];
                    $("#canvas-layers").css({"top":( $("#canvas-layers").css("top").replace("px","")-rozdily),"left":( $("#canvas-layers").css("left").replace("px","")-rozdilx)});
                }
            }
        }

        /* crop */
        const cropCanvas = (sourceCanvas,left,top,width,height) => {
            let destCanvas = document.createElement('canvas');
            destCanvas.width = width;
            destCanvas.height = height;
            destCanvas.getContext("2d").drawImage(sourceCanvas,left,top,width,height,0,0,width,height);      // newCanvas, same size as source rect
            return destCanvas;
        }
        $(".dropzoned").change(function () {
    var reader = new FileReader();
    var f = document.getElementById("file-select").files;
    reader.onloadend = function () {
        var data=reader.result;
        originalimagedata =data;
        var myImage = new Image();
        myImage.src = data;
        myImage.id="img";
        setTimeout(() => {  
        var width=myImage.width;
        var height=myImage.height;
        var pomer=width/height;
        if(height>size[1]){
            height=size[1];
            width=pomer*size[1];
        }
        else if(width>size[0]){
            width=size[0];
            height=pomer*size[0];
        }
        
        canvas.createLayer("Layer "+canvas.layers.length,[width, height]);
        canvas.layers[canvas.layers.length-1].importImage(myImage);
        canvas.render();
    }, 500);
       
    }
    reader.readAsDataURL(f[0]);
    $("#file-select").hide();
    
});
  
            let line;
                line = new RGraph.Line({
        id: 'PrevodniChrka',
        data: [
            [0,50,100,150,200,255]
        ],
        options: {
            linewidth: 0,
            marginInner: 0,
            shadow: false,
            adjustable: true,
            outofbounds: true,
            yaxisScaleMax: 255,
            yaxisScaleMin: 0,
            tickmarksStyle: 'circle',
            tickmarksSize: 5,
            xaxisTickmarks: false,
            yaxisTickmarks: false,
            yaxis:false,
            xaxis:false,
            yaxisLabels: false,
            xaxisLabels: false,
            yaxisTickmarks:false,
            yaxisTickmarksCount:0,
            yaxisLabelsCount:0,
            yaxisLabels:[],
            textSize:1,
            textColor: 'transparent',
            marginBottom:0,
            marginTop:0,
            marginLeft:0,
            marginRight:0
        }
    });
    line.trace();
    line.canvas.addEventListener('mouseup', function(e){
        if(e.detail==1){
        var arr=[],last_x=0;
        for(var i=0; i<line.data[0].length;i++){
            var delka=Math.floor(255/(line.data[0].length)-1);
            var pro_prevyseni=0;
            if (line.data_arr[i]){
                pro_prevyseni=line.data[0][i];
            }
            else{
                pro_prevyseni=0.00001;
            }
            var prevyseni=pro_prevyseni*(((line.data_arr[i+1]/pro_prevyseni)-1)/delka);
            last_y=line.data[0][i];
            for(var x=0;x<delka;x++){
                if(last_y>255 || isNaN(last_y)){
                    last_y=pro_prevyseni;
                }
                else if(last_y<0){
                    last_y=0;
                }
                arr.push(last_y);
                last_y=last_y+prevyseni;
                last_x++
            }
        }
        var delka_arr=arr.length;
        for(var i=0;i<256-delka_arr;i++){
            arr.push(arr[delka_arr-1])
        }
        canvas.chrka=arr;
        canvas.render();}
        else{
            var arr=[];
    for(var i=0;i<256;i++){
        arr.push(i);
    }
    arr_to_update=[0,50,100,150,200,255];
    RGraph.clear(document.getElementById("PrevodniChrka")); 
    line.original_data[0]=arr_to_update;   
    line.trace();
    canvas.chrka=arr;
    canvas.render();
        }
    });
    
        </script>

        <script type="text/javascript">
        $.event.special.rightclick = {
    bindType: "contextmenu",
    delegateType: "contextmenu"


};
$(document).on("rightclick", ".layerShowing", function(e) {
    $(".activeLayer").removeClass("activeLayer");
    $(this).addClass("activeLayer");
    var id= $(".activeLayer").attr("layer-id");
    $("#alpha").val(canvas.layers[id].alphaProcesingData);
    $("#LayerControls").show()
    $("#LayerControls").css("top",e.pageY - $("#LayerControls").css("height").replace("px",""));
    $("#LayerControls").css("left",e.pageX - $("#LayerControls").css("width").replace("px",""));
    return false;
});
$("#LayerControls").hide();

$(document).on("click",function(e){
    if($("#LayerControls").css("display")!="none"){
        var width=document.getElementById("LayerControls").clientWidth;
        var height=document.getElementById("LayerControls").clientHeight;
        var top=parseInt(document.getElementById("LayerControls").style.top.replace("px",""));
        var left=parseInt(document.getElementById("LayerControls").style.left.replace("px",""));
        if(e.pageX < left|| e.pageX> left+width || e.pageY < top || e.pageY > top + height){
            $("#LayerControls").hide();
        }
    }
});
        </script>
    <script src="{% static 'assets/FileSaver.js'%}"> </script>
    <script src="{% static 'assets/main.js'%}"> </script>
</html>